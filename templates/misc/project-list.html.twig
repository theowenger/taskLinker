{% extends 'base.html.twig' %}
{% block body %}

    {% include 'component/header.html.twig' with {'active': 'project'} %}

    <main>
        <header>
            {% include 'component/avatar-header.html.twig' %}
            <div id="title-page">
                <h1>Projets</h1>
            </div>
        </header>
        <body>
        <div id="content">
            <div id="projects-container">
                {% for project in projects %}
                <article class="card-project">
                    <a href="{{ path('app_project_item', {'id': project.id}) }}">
                        <h2>{{ project.name }}</h2>
                    </a>
                    <div class="card-project-icons">
                        {% if app.user is not null and 'ROLE_ADMIN' in app.user.roles %}
                        <a href="{{ path('app_project_item_edit', {'id': project.id}) }}"><i class="fa-solid fa-pen pen-color"></i></a>
                        <a href="#" onclick="return confirmDelete('{{ project.id }}', '{{ project.name }}');"><i class="fa-solid fa-trash trash-color"></i></a>
                        {% endif %}
                    </div>
                </article>
                {% endfor %}
                {% if app.user is not null and 'ROLE_ADMIN' in app.user.roles %}
                <article class="card-project">
                    <a href="{{ path('app_project_item_edit', {'id': null}) }}">
                        <i class="fa-solid fa-circle-plus add-project-icon"></i>
                        <h2>Ajouter un projet</h2>
                    </a>
                </article>
                {% endif %}
            </div>
        </div>
        </body>
    </main>

    <script>
        function confirmDelete(id, name) {
            const confirmationMessage = `Êtes-vous sûr de vouloir archiver ${name} ?`;
            const confirmDelete = confirm(confirmationMessage);

            if (confirmDelete) {
                const xhr = new XMLHttpRequest();
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        window.location.href = "/";
                    } else {
                        console.error("Erreur lors de l'archivage du projet :", xhr.statusText);
                    }
                };

                xhr.open("POST", `/project/${id}/archive`);
                xhr.send();
                return false;
            } else {
                return true;
            }
        }
    </script>

{% endblock %}